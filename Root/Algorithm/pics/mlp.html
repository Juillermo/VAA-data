<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="d3viz/css/d3viz.css"/>
	<link rel="stylesheet" href="d3viz/css/d3-context-menu.css"/>
	<script type="text/javascript" src="d3viz/js/d3viz.js"></script>
	<script type="text/javascript" src="d3viz/js/d3.v3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/dagre-d3.min.js"></script>
	<script type="text/javascript" src="d3viz/js/graphlib-dot.min.js"></script>
	<script type="text/javascript" src="d3viz/js/d3-context-menu.js"></script>
</head>
<body>
	<div id='menu' class='menuBar'>
	    <input name="resetNodes" 
	           type="button" 
	           value="Reset nodes"
	           onclick="resetNodes()"/>
	    <input name="releaseNodes" 
	           type="button" 
	           value="Release nodes"
	           onclick="releaseNodes()"/>
	</div>

	<script type="text/javascript">
		// Backend graph in DOT format
		var dotGraph = graphlibDot.read("digraph G {\n\tgraph [bb=\"0,0,815.65,819\"];\n\tnode [label=\"\\N\"];\n\tn1\t [apply_op=DimShuffle,\n\t\theight=0.5,\n\t\tlabel=DimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"227.65,627\",\n\t\tshape=ellipse,\n\t\twidth=1.4624];\n\tn20\t [apply_op=BatchedDot,\n\t\theight=0.5,\n\t\tlabel=BatchedDot,\n\t\tnode_type=apply,\n\t\tpos=\"52.645,540\",\n\t\tshape=ellipse,\n\t\twidth=1.4624];\n\tn1 -> n20\t [label=\"1 float64\",\n\t\tlp=\"175.15,583.5\",\n\t\tpos=\"e,81.74,555.13 198.35,611.77 168.86,597.45 123.23,575.28 90.898,559.58\"];\n\tn2\t [dtype=float64,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=p,\n\t\tnode_type=input,\n\t\tpos=\"293.65,714\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn2 -> n1\t [color=dodgerblue,\n\t\tlabel=float64,\n\t\tlp=\"284.15,670.5\",\n\t\tpos=\"e,240.53,644.6 280.29,695.8 270.68,683.43 257.58,666.55 246.85,652.74\"];\n\tn4\t [apply_op=Shape_i,\n\t\tfillcolor=cyan,\n\t\theight=0.5,\n\t\tlabel=Shape_i,\n\t\tnode_type=apply,\n\t\tpos=\"352.65,627\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.0832];\n\tn2 -> n4\t [label=float64,\n\t\tlp=\"347.15,670.5\",\n\t\tpos=\"e,341.32,644.31 305.58,695.8 314.15,683.46 325.81,666.66 335.39,652.86\"];\n\tn16\t [apply_op=MakeVector,\n\t\theight=0.5,\n\t\tlabel=MakeVector,\n\t\tnode_type=apply,\n\t\tpos=\"178.65,540\",\n\t\tshape=ellipse,\n\t\twidth=1.5346];\n\tn4 -> n16\t [label=\"1 float64\",\n\t\tlp=\"298.15,583.5\",\n\t\tpos=\"e,205.83,555.93 324.65,614.14 309.45,607.57 290.39,599.1 273.65,591 253.93,581.46 232.3,570.14 214.66,560.69\"];\n\tn18\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"526.65,540\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2818];\n\tn4 -> n18\t [label=\"1 float64\",\n\t\tlp=\"483.15,583.5\",\n\t\tpos=\"e,499.87,554.81 379.47,613.73 393.81,607.1 411.75,598.72 427.65,591 448.69,580.78 472.05,569 490.79,559.44\"];\n\tn24\t [apply_op=Elemwise,\n\t\tfillcolor=\"#FFAABB\",\n\t\theight=0.5,\n\t\tlabel=Elemwise,\n\t\tnode_type=apply,\n\t\tpos=\"524.65,453\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.2818];\n\tn4 -> n24\t [label=\"3 bscalar\",\n\t\tlp=\"447.15,540\",\n\t\tpos=\"e,495.25,466.96 376.6,612.37 384.87,606.67 393.56,599.41 399.65,591 418.59,564.81 403.02,547.69 422.65,522 439.26,500.24 464.93,\\\n483.18 486.36,471.59\"];\n\tn6\t [apply_op=DimShuffle,\n\t\theight=0.5,\n\t\tlabel=DimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"74.645,714\",\n\t\tshape=ellipse,\n\t\twidth=1.4624];\n\tn13\t [apply_op=BatchedDot,\n\t\theight=0.5,\n\t\tlabel=BatchedDot,\n\t\tnode_type=apply,\n\t\tpos=\"74.645,627\",\n\t\tshape=ellipse,\n\t\twidth=1.4624];\n\tn6 -> n13\t [label=\"0 float64\",\n\t\tlp=\"99.145,670.5\",\n\t\tpos=\"e,74.645,645.18 74.645,695.8 74.645,684.16 74.645,668.55 74.645,655.24\"];\n\tn7\t [dtype=float64,\n\t\tfillcolor=limegreen,\n\t\theight=0.5,\n\t\tlabel=u,\n\t\tnode_type=input,\n\t\tpos=\"526.65,801\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn7 -> n6\t [color=dodgerblue,\n\t\tlabel=float64,\n\t\tlp=\"316.15,757.5\",\n\t\tpos=\"e,113.53,726.27 499.52,796.18 435.81,787 271.79,762.24 136.65,732 132.3,731.03 127.8,729.95 123.31,728.81\"];\n\tn9\t [apply_op=Shape_i,\n\t\tfillcolor=cyan,\n\t\theight=0.5,\n\t\tlabel=Shape_i,\n\t\tnode_type=apply,\n\t\tpos=\"526.65,627\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.0832];\n\tn7 -> n9\t [label=float64,\n\t\tlp=\"546.15,714\",\n\t\tpos=\"e,526.65,645.05 526.65,782.88 526.65,753 526.65,691.11 526.65,655.27\"];\n\tn11\t [apply_op=Shape_i,\n\t\tfillcolor=cyan,\n\t\theight=0.5,\n\t\tlabel=Shape_i,\n\t\tnode_type=apply,\n\t\tpos=\"714.65,540\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.0832];\n\tn7 -> n11\t [label=float64,\n\t\tlp=\"645.15,670.5\",\n\t\tpos=\"e,702.8,557.31 539.27,782.6 571.88,737.68 658.99,617.67 696.76,565.64\"];\n\tn9 -> n16\t [label=\"0 float64\",\n\t\tlp=\"399.15,583.5\",\n\t\tpos=\"e,219.56,552.12 492.11,618.61 461.21,611.87 414.75,601.39 374.65,591 351.36,584.97 345.94,581.98 322.65,576 287.34,566.95 278.04,\\\n566.68 242.65,558 238.32,556.94 233.84,555.81 229.35,554.66\"];\n\tn9 -> n18\t [label=\"0 float64\",\n\t\tlp=\"551.15,583.5\",\n\t\tpos=\"e,526.65,558.18 526.65,608.8 526.65,597.16 526.65,581.55 526.65,568.24\"];\n\tn9 -> n24\t [label=\"2 bscalar\",\n\t\tlp=\"612.15,540\",\n\t\tpos=\"e,555.2,466.62 554.44,614.14 564.09,608.57 573.91,600.93 579.65,591 594.99,564.43 582.57,552.67 581.65,522 581.2,507.31 587.1,501.66 \\\n579.65,489 575.78,482.43 570.13,476.89 563.92,472.3\"];\n\tn22\t [apply_op=MakeVector,\n\t\theight=0.5,\n\t\tlabel=MakeVector,\n\t\tnode_type=apply,\n\t\tpos=\"643.65,453\",\n\t\tshape=ellipse,\n\t\twidth=1.5346];\n\tn11 -> n22\t [label=\"1 float64\",\n\t\tlp=\"791.15,496.5\",\n\t\tpos=\"e,698.51,455.88 740.95,526.5 757.56,516.88 774.07,502.9 763.65,489 750.61,471.61 729.41,462.47 708.43,457.79\"];\n\tn11 -> n24\t [label=\"4 bscalar\",\n\t\tlp=\"700.15,496.5\",\n\t\tpos=\"e,559.18,465.01 699.18,523.27 687.39,512.15 670.24,497.72 652.65,489 622.71,474.16 611.84,479.94 579.65,471 576.12,470.02 572.47,\\\n468.97 568.81,467.9\"];\n\tn13 -> n20\t [label=\"0 float64\",\n\t\tlp=\"90.145,583.5\",\n\t\tpos=\"e,57.091,558.18 70.193,608.8 67.182,597.16 63.14,581.55 59.695,568.24\"];\n\tn14\t [dtype=float64,\n\t\tfillcolor=YellowGreen,\n\t\theight=0.5,\n\t\tlabel=D,\n\t\tnode_type=shared_input,\n\t\tpos=\"172.65,714\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn14 -> n13\t [label=\"1 float64\",\n\t\tlp=\"167.15,670.5\",\n\t\tpos=\"e,100.12,642.96 159.03,695.78 150.58,685.64 139.15,672.91 127.65,663 121.84,658 115.29,653.14 108.82,648.71\"];\n\tn39\t [apply_op=Reshape,\n\t\theight=0.5,\n\t\tlabel=Reshape,\n\t\tnode_type=apply,\n\t\tpos=\"240.65,192\",\n\t\tshape=ellipse,\n\t\twidth=1.1193];\n\tn16 -> n39\t [label=\"1 dscalar\",\n\t\tlp=\"200.15,366\",\n\t\tpos=\"e,219.72,207.64 177.68,521.75 176.8,504.58 175.65,477.48 175.65,454 175.65,454 175.65,454 175.65,278 175.65,252.39 194.5,229.7 211.9,\\\n214.23\"];\n\tn18 -> n22\t [label=\"0 float64\",\n\t\tlp=\"624.15,496.5\",\n\t\tpos=\"e,624.06,469.95 549.87,524.23 559.24,518.13 570.07,510.89 579.65,504 591.78,495.28 604.83,485.21 615.97,476.4\"];\n\tn18 -> n24\t [color=red,\n\t\tlabel=\"0 float64\",\n\t\tlp=\"551.15,496.5\",\n\t\tpos=\"e,525.05,471.18 526.24,521.8 525.97,510.16 525.6,494.55 525.29,481.24\"];\n\tn21\t [dtype=float64,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=float64,\n\t\tnode_type=output,\n\t\tpos=\"52.645,453\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.76389];\n\tn20 -> n21\t [label=float64,\n\t\tlp=\"72.145,496.5\",\n\t\tpos=\"e,52.645,471.18 52.645,521.8 52.645,510.16 52.645,494.55 52.645,481.24\"];\n\tn28\t [apply_op=DimShuffle,\n\t\theight=0.5,\n\t\tlabel=DimShuffle,\n\t\tnode_type=apply,\n\t\tpos=\"263.65,453\",\n\t\tshape=ellipse,\n\t\twidth=1.4624];\n\tn20 -> n28\t [color=dodgerblue,\n\t\tlabel=bscalar,\n\t\tlp=\"191.15,496.5\",\n\t\tpos=\"e,230.91,467.19 85.614,525.72 122.23,510.97 181.45,487.11 221.43,471\"];\n\tn32\t [apply_op=Reshape,\n\t\theight=0.5,\n\t\tlabel=Reshape,\n\t\tnode_type=apply,\n\t\tpos=\"282.65,366\",\n\t\tshape=ellipse,\n\t\twidth=1.1193];\n\tn22 -> n32\t [label=\"1 bscalar\",\n\t\tlp=\"648.15,409.5\",\n\t\tpos=\"e,311.83,378.56 635.91,434.97 629.74,423.52 619.92,409.24 606.65,402 552.89,372.66 391.67,396.15 331.65,384 328.28,383.32 324.83,\\\n382.46 321.39,381.5\"];\n\tn30\t [apply_op=AllocEmpty,\n\t\tfillcolor=\"#FFAA22\",\n\t\theight=0.5,\n\t\tlabel=AllocEmpty,\n\t\tnode_type=apply,\n\t\tpos=\"611.65,366\",\n\t\tshape=ellipse,\n\t\tstyle=filled,\n\t\ttype=colored,\n\t\twidth=1.4985];\n\tn24 -> n30\t [label=bscalar,\n\t\tlp=\"587.15,409.5\",\n\t\tpos=\"e,590.38,382.61 537.47,435.55 545.66,425.45 556.76,412.48 567.65,402 572.26,397.56 577.4,393.09 582.49,388.91\"];\n\tn25\t [dtype=bscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=-1,\n\t\tnode_type=constant_input,\n\t\tpos=\"278.65,540\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn25 -> n24\t [label=\"1 bscalar\",\n\t\tlp=\"317.15,496.5\",\n\t\tpos=\"e,478.71,455.16 278.93,521.69 280.08,510.72 283.46,497.12 292.65,489 318.04,466.56 408.41,458.51 468.58,455.61\"];\n\tn26\t [dtype=bscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1,\n\t\tnode_type=constant_input,\n\t\tpos=\"350.65,540\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn26 -> n24\t [label=\"5 bscalar\",\n\t\tlp=\"376.15,496.5\",\n\t\tpos=\"e,479.5,456.87 346.03,521.84 344.27,511.21 344.19,497.93 351.65,489 366.54,471.16 424.52,462.17 469.3,457.81\"];\n\tn28 -> n32\t [color=dodgerblue,\n\t\tlabel=\"0 bscalar\",\n\t\tlp=\"299.15,409.5\",\n\t\tpos=\"e,278.81,384.18 267.49,434.8 270.09,423.16 273.58,407.55 276.56,394.24\"];\n\tn34\t [apply_op=CGemv,\n\t\theight=0.5,\n\t\tlabel=CGemv,\n\t\tnode_type=apply,\n\t\tpos=\"403.65,279\",\n\t\tshape=ellipse,\n\t\twidth=1.0652];\n\tn30 -> n34\t [color=red,\n\t\tlabel=\"0 bscalar\",\n\t\tlp=\"595.15,322.5\",\n\t\tpos=\"e,440.32,284.69 594.77,348.82 582.37,337.78 564.61,323.63 546.65,315 516.28,300.41 479.27,291.57 450.51,286.42\"];\n\tn32 -> n34\t [label=\"2 dscalar\",\n\t\tlp=\"337.15,322.5\",\n\t\tpos=\"e,369.27,287.42 289.29,348.18 294.3,337.41 302.1,323.86 312.65,315 326.06,303.73 343.51,295.85 359.53,290.46\"];\n\tn34 -> n39\t [color=dodgerblue,\n\t\tlabel=\"0 dscalar\",\n\t\tlp=\"357.15,235.5\",\n\t\tpos=\"e,265.9,206.17 378.89,265.09 351.21,250.65 306.18,227.17 275.08,210.95\"];\n\tn35\t [dtype=dscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=1.,\n\t\tnode_type=constant_input,\n\t\tpos=\"367.65,366\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn35 -> n34\t [label=\"1 dscalar\",\n\t\tlp=\"393.15,322.5\",\n\t\tpos=\"e,383.88,294.69 364.88,347.67 364.04,337.72 364.29,325.22 368.65,315 370.6,310.4 373.48,306.08 376.76,302.16\"];\n\tn36\t [dtype=dvector,\n\t\tfillcolor=YellowGreen,\n\t\theight=0.5,\n\t\tlabel=w,\n\t\tnode_type=shared_input,\n\t\tpos=\"439.65,366\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn36 -> n34\t [label=\"3 dvector\",\n\t\tlp=\"450.65,322.5\",\n\t\tpos=\"e,410.8,296.89 432.36,347.8 427.3,335.85 420.47,319.72 414.73,306.18\"];\n\tn37\t [dtype=dscalar,\n\t\tfillcolor=SpringGreen,\n\t\theight=0.5,\n\t\tlabel=0.,\n\t\tnode_type=constant_input,\n\t\tpos=\"512.65,366\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.75];\n\tn37 -> n34\t [label=\"4 dscalar\",\n\t\tlp=\"518.15,322.5\",\n\t\tpos=\"e,434.85,289.51 504.88,347.92 499.36,337.32 491.08,324.04 480.65,315 470.12,305.88 456.83,298.71 444.26,293.31\"];\n\tn41\t [apply_op=Softmax,\n\t\theight=0.5,\n\t\tlabel=Softmax,\n\t\tnode_type=apply,\n\t\tpos=\"240.65,105\",\n\t\tshape=ellipse,\n\t\twidth=1.1374];\n\tn39 -> n41\t [label=dscalar,\n\t\tlp=\"260.15,148.5\",\n\t\tpos=\"e,240.65,123.18 240.65,173.8 240.65,162.16 240.65,146.55 240.65,133.24\"];\n\tn42\t [dtype=dmatrix,\n\t\tfillcolor=dodgerblue,\n\t\theight=0.5,\n\t\tlabel=dmatrix,\n\t\tnode_type=output,\n\t\tpos=\"240.65,18\",\n\t\tshape=box,\n\t\tstyle=filled,\n\t\twidth=0.81944];\n\tn41 -> n42\t [label=dmatrix,\n\t\tlp=\"262.15,61.5\",\n\t\tpos=\"e,240.65,36.175 240.65,86.799 240.65,75.163 240.65,59.548 240.65,46.237\"];\n}\n");
		// Frontend graph for visualization
		var graph = {};
		
		var forceLayout;
		var isProfiled = false; // true if profiling information available
		var useProfileColors = false;
		var fixOnInit = true; // fix nodes on initialization
		var maxProfilePer = 0;
		var profileColors = ["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15"];
		var pad = 10;
		var isEditNode = false; // true if node is edited
		var menuItems = [
			{
				title: 'Edit',
				action: function(elm, d, i) { editNode(elm, d); }
			},
			{
				title: 'Release',
				action: function(elm, d, i) { releaseNode(d); }
			}
		];

		// Create main panel
		d3.select('body').select('svg').remove();
		var svg = d3.select('body').append('svg')
			.attr('width', '100%')
			.attr('height', '95%');
		var pane = svg.append('g');
		
		// Zoom behaviour
		var zoom = d3.behavior.zoom()
			.scaleExtent([0.2, 8])
			.on('zoom', function(d) {
				var trans = d3.event.translate;
				trans[0] += 300;
				trans[1] += 100;
				pane.attr('transform', 'translate(' + trans + ') scale(' + d3.event.scale + ')');
			});
		svg.call(zoom);
		zoom.event(svg);
		svg.on("dblclick.zoom", null);
		
		// Edges
		var edgeDiv = d3.select('body').append('div')
			.attr('class', 'edgeTooltip')
			.style('opacity', 0.0);
		
		// Div for node details	
		var nodeInfo = d3.select('body').append('div')
			.attr('class', 'nodeInfo')
			.style('opacity', 0.0);
		
		// Definition head of edges
		var markerData = [
			{'id': 'n', 'color': 'black'},
			{'id': 'r', 'color': 'red'},
			{'id': 'b', 'color': 'dodgerblue'}];
		svg.append("defs").selectAll('marker').data(markerData).enter().append("marker")
		    .attr("id", function(d) { return 'edgeArrow_' + d.id;})
		    .attr("markerWidth", 4)
		    .attr("markerHeight", 4)
		    .attr("refX", 2)
		    .attr("refY", 2)
		    .attr("orient", "auto")
		  	.append("path")
		    .attr("d", "M0,0 L4,2 L0,4 Z")
		    .attr('fill', function(d) { return d.color;});
	
		// Initialize graph
		processDotGraph(dotGraph);		
		graph = frontEndGraph(dotGraph);
		drawGraph();
	</script>
</body>
</html>
